<!DOCTYPE html>
<html lang="pt-BR">
<head><meta charset="utf-8"><title>Rover</title></head>
<body>
  <h1>Rover</h1>
  <input id="msg" placeholder="Mensagem...">
  <button id="send">Enviar</button>
  <pre id="log" style="height:200px;overflow:auto;border:1px solid #ccc"></pre>

  <script>
    const ws = new WebSocket(`ws://${location.host}/ws`);
    let heartbeatInterval;

    ws.addEventListener('open', () => {
      log("Conectado! Registrando como rover...");
      ws.send(JSON.stringify({ type: 'register', role: 'rover' }));

      // Iniciar heartbeat: manda um 'ping' a cada 20 segundos
      heartbeatInterval = setInterval(() => {
        if (ws.readyState === WebSocket.OPEN) {
          ws.send(JSON.stringify({ type: 'ping' }));
          log("(Ping enviado)");
        }
      }, 20000);
    });

    ws.addEventListener('message', e => log(`Recebido: ${e.data}`));

    ws.addEventListener('close', () => {
      log('Desconectado');
      clearInterval(heartbeatInterval);
    });

    document.getElementById('send').onclick = () => {
      const txt = document.getElementById('msg').value.trim();
      if (!txt) return;
      ws.send(JSON.stringify({ type: 'test', payload: txt }));
      log(`Enviado: ${txt}`);
    };

    function log(msg) {
      const pre = document.getElementById('log');
      pre.textContent += msg + '\n';
      pre.scrollTop = pre.scrollHeight;
    }
  </script>
</body>
</html>
