<!DOCTYPE html>
<html lang="pt-BR">
<head><meta charset="utf-8"><title>WS Test</title></head>
<body>
  <h1>Teste WS – ROLE: <span id="role"></span></h1>
  <input id="msg" placeholder="mensagem…"><button id="send">Enviar</button>
  <pre id="log" style="height:200px;overflow:auto;border:1px solid #ccc"></pre>

  <script>

    const rover = 'rover';  
    document.getElementById('role').textContent = rover;

    const ws = new WebSocket(`ws://${location.host}/ws`);
    ws.addEventListener('open', () => {
      log(`→ conectado, registrando como ${rover}`);
      ws.send(JSON.stringify({ type:'register', role:rover }));
    });
    ws.addEventListener('message', e => log(`← recebido: ${e.data}`));
    ws.addEventListener('close', () => log('** desconectado **'));

    document.getElementById('send').onclick = () => {
      const txt = document.getElementById('msg').value.trim();
      if (!txt) return;
      ws.send(JSON.stringify({ type:'test', payload: txt }));
      log(`→ enviado: ${txt}`);
    };

    function log(txt){
      const pre = document.getElementById('log');
      pre.textContent += txt + '\n';
      pre.scrollTop = pre.scrollHeight;
    }
  </script>
</body>
</html>
