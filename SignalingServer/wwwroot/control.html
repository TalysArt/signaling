<!DOCTYPE html>
<html lang="pt-BR">
<head><meta charset="utf-8"><title>Controle</title></head>
<body>
  <h1>Controle</h1>
  <input id="msg" placeholder="Mensagem...">
  <button id="send">Enviar</button>
  <pre id="log" style="height:200px;overflow:auto;border:1px solid #ccc"></pre>

  <script>
    const ws = new WebSocket(`ws://${location.host}/ws`);
    ws.addEventListener('open', () => {
      log("Conectado! Registrando como controle...");
      ws.send(JSON.stringify({ type: 'register', role: 'control' }));
    });
    ws.addEventListener('message', e => log(`Recebido: ${e.data}`));
    ws.addEventListener('close', () => log('Desconectado'));

    document.getElementById('send').onclick = () => {
      const txt = document.getElementById('msg').value.trim();
      if (!txt) return;
      ws.send(JSON.stringify({ type: 'test', payload: txt }));
      log(`Enviado: ${txt}`);
    };

    function log(msg) {
      const pre = document.getElementById('log');
      pre.textContent += msg + '\n';
      pre.scrollTop = pre.scrollHeight;
    }
  </script>
</body>
</html>
